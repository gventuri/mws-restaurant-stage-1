let neighborhoods,cuisines,restaurants=[];var map,markers=[];'serviceWorker'in navigator&&window.addEventListener('load',function(){navigator.serviceWorker.register('sw.js').then(function(a){console.log('ServiceWorker registration successful with scope: ',a.scope)}).catch(function(a){console.log('ServiceWorker registration failed: ',a)})}),document.addEventListener('DOMContentLoaded',()=>{var b=document.createElement('script');b.type='text/javascript',b.src='https://maps.googleapis.com/maps/api/js?key=AIzaSyDZO7fxB9DC1sDmPqHnETdpcGCiPjEm9Og&libraries=places&callback=initMap',document.head.appendChild(b),request.onsuccess=function(){db=request.result;let d=db.transaction('restaurants').objectStore('restaurants');d.openCursor().onsuccess=function(e){let f=e.target.result;f?(!window.restaurants&&(window.restaurants=[]),window.restaurants.push(f.value),f.continue()):(fetchNeighborhoods(),fetchCuisines(),updateRestaurants())}},window.initMap=()=>{self.map=new google.maps.Map(document.getElementById('map'),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1})}}),fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods((a,b)=>{a?console.error(a):(self.neighborhoods=b,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=(a=self.neighborhoods)=>{const b=document.getElementById('neighborhoods-select');a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},fetchCuisines=()=>{DBHelper.fetchCuisines((a,b)=>{a?console.error(a):(self.cuisines=b,fillCuisinesHTML())})},fillCuisinesHTML=(a=self.cuisines)=>{const b=document.getElementById('cuisines-select');a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},updateRestaurants=()=>{const a=document.getElementById('cuisines-select'),b=document.getElementById('neighborhoods-select'),c=a.selectedIndex,d=b.selectedIndex,e=a[c].value,f=b[d].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(e,f,(g,h)=>{g?console.error(g):(resetRestaurants(h),fillRestaurantsHTML())})},resetRestaurants=a=>{self.restaurants=[];const b=document.getElementById('restaurants-list');b.innerHTML='',self.markers.forEach(c=>c.setMap(null)),self.markers=[],self.restaurants=a},fillRestaurantsHTML=(a=self.restaurants)=>{const b=document.getElementById('restaurants-list');a.forEach(c=>{b.append(createRestaurantHTML(c))}),addMarkersToMap()},createRestaurantHTML=a=>{const b=document.createElement('li');b.classList.add('col','col-1-4','col-1-2-sm','col-1-3-md');const c=document.createElement('div');c.classList.add('card'),b.append(c);const d=document.createElement('img');d.className='restaurant-img',d.setAttribute('data-src',DBHelper.imageUrlForRestaurant(a,'sm')),d.setAttribute('alt',`Photo of the restaurant "${a.name}"`),c.append(d);const e=document.createElement('h2');e.innerHTML=a.name,e.className='truncate',c.append(e);const f=document.createElement('p');f.innerHTML=a.neighborhood,c.append(f);const g=document.createElement('p');g.innerHTML=a.address,g.className='truncate',c.append(g);const h=document.createElement('a');h.innerHTML='View Details',h.setAttribute('alt',`More details about "${a.name}"`),h.href=DBHelper.urlForRestaurant(a),c.append(h);new LazyLoad;return b},addMarkersToMap=(a=self.restaurants)=>{a.forEach(b=>{const c=DBHelper.mapMarkerForRestaurant(b,self.map);google.maps.event.addListener(c,'click',()=>{window.location.href=c.url}),self.markers.push(c)})},window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,window.indexedDB||console.log('This browser doesn\'t support IndexedDB');let db,request=window.indexedDB.open('MyDatabase',1);request.onerror=function(){console.log('Error connecting to the db')},request.onupgradeneeded=function(a){window.db=a.target.result;var b=window.db.createObjectStore('restaurants',{keyPath:'id'}),c=window.db.createObjectStore('reviews',{keyPath:'id'})};function add2DB(a,b){console.log(b),window.request=b.transaction(['restaurants'],'readwrite').objectStore('restaurants').add(a),window.request.onsuccess=function(){console.log('The restaurant has been added to the db')},window.request.onerror=function(){console.log('Unable to add to the db')}}